<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Metro's Music Player</title>
<style>
  body {
    margin: 0;
    height: 100vh;
    background: black; 
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-family: Arial, sans-serif;
    color: white;
  }

  canvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
  }

  .song-menu {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    z-index: 2;
  }

  .song-menu button {
    padding: 6px 12px;
    border: 1px solid #fff;
    border-radius: 20px;
    font-size: 14px;
    cursor: pointer;
    color: #fff;
    background: transparent;
    text-shadow: 0 0 10px #fff, 0 0 20px #fff;
    box-shadow: 0 0 10px #fff, 0 0 20px #fff;
    transition: all 0.3s ease;
  }

  .song-menu button:hover {
    text-shadow: 0 0 20px #0ff, 0 0 40px #0ff;
    box-shadow: 0 0 20px #0ff, 0 0 40px #0ff;
    color: #0ff;
  }

  .song-menu button.active {
    text-shadow: 0 0 20px #0ff, 0 0 40px #0ff; /* Neon cyan for active song */
    box-shadow: 0 0 20px #0ff, 0 0 40px #0ff;
    color: #0ff;
  }

  .controls {
    display: flex;
    flex-direction: column;
    align-items: center;
    z-index: 1;
    text-align: center;
  }

  h1 {
    font-size: 1.5rem;
    margin-bottom: 10px;
    color: #fff;
    text-shadow: 0 0 10px #fff, 0 0 20px #fff, 0 0 30px #fff;
  }

  button, input[type="file"], input[type="range"] {
    margin: 5px;
    padding: 8px 18px;
    border: 1px solid #fff;
    border-radius: 25px;
    font-size: 14px;
    cursor: pointer;
    color: #fff;
    background: transparent;
    text-shadow: 0 0 10px #fff, 0 0 20px #fff;
    box-shadow: 0 0 10px #fff, 0 0 20px #fff;
    transition: all 0.3s ease;
  }

  input[type="range"] {
    width: 200px;
    padding: 0;
    border-radius: 10px;
    -webkit-appearance: none;
    background: #222;
  }

  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 15px;
    height: 15px;
    background: #fff;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 0 10px #fff;
  }

  input[type="range"]::-moz-range-thumb {
    width: 15px;
    height: 15px;
    background: #fff;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 0 10px #fff;
  }

  #progressContainer {
    width: 300px;
    height: 8px;
    background: #222;
    border-radius: 4px;
    margin-top: 10px;
    cursor: pointer;
  }

  #progress {
    width: 0%;
    height: 100%;
    background: #fff;
    border-radius: 4px;
  }
</style>
</head>
<body>
<canvas id="visualizer"></canvas>

<!-- Song selection menu -->
<div class="song-menu">
  <button data-file="ascension.mp3">Ascension</button>
  <button data-file="neptune.mp3">Neptune</button>
</div>

<div class="controls">
  <h1 id="trackTitle">Now Playing: None</h1>
  <button id="playPauseBtn" disabled>▶ Play</button>
  <input type="file" id="fileInput" accept="audio/*">
  <input type="range" id="volumeControl" min="0" max="1" step="0.01" value="1">
  <div id="progressContainer">
    <div id="progress"></div>
  </div>
</div>

<audio id="audio" crossorigin="anonymous"></audio>

<script>
const canvas = document.getElementById('visualizer');
const ctx = canvas.getContext('2d');
const audio = document.getElementById('audio');
const playPauseBtn = document.getElementById('playPauseBtn');
const fileInput = document.getElementById('fileInput');
const trackTitle = document.getElementById('trackTitle');
const volumeControl = document.getElementById('volumeControl');
const progressContainer = document.getElementById('progressContainer');
const progress = document.getElementById('progress');
const songButtons = document.querySelectorAll('.song-menu button');

let isPlaying = false;
let currentSong = ""; // No song selected initially

// Resize canvas
function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// ====== Web Audio Setup ======
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
const source = audioCtx.createMediaElementSource(audio);
const analyser = audioCtx.createAnalyser();
source.connect(analyser);
analyser.connect(audioCtx.destination);
analyser.fftSize = 256;

const bufferLength = analyser.frequencyBinCount;
const dataArray = new Uint8Array(bufferLength);

// ====== White stars background ======
const stars = [];
const starCount = 200;
for (let i = 0; i < starCount; i++) {
  stars.push({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    size: Math.random() * 2 + 0.5,
    speed: Math.random() * 0.5 + 0.1
  });
}

// ====== Draw loop ======
function draw() {
  requestAnimationFrame(draw);

  // Clear background
  ctx.fillStyle = 'black';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // Draw stars
  ctx.fillStyle = 'white';
  stars.forEach(s => {
    ctx.beginPath();
    ctx.arc(s.x, s.y, s.size, 0, Math.PI * 2);
    ctx.fill();
    s.y -= s.speed;
    if (s.y < 0) s.y = canvas.height;
  });

  // Draw circular music bars
  analyser.getByteFrequencyData(dataArray);
  const centerX = canvas.width / 2;
  const centerY = canvas.height / 2;
  const radius = 150;
  const barCount = bufferLength;
  const angleStep = (Math.PI * 2) / barCount;

  for (let i = 0; i < barCount; i++) {
    const value = dataArray[i];
    const barLength = value * 1.2;
    const angle = i * angleStep;
    const hue = (i * 360 / barCount + performance.now() / 10) % 360;

    ctx.save();
    ctx.translate(centerX, centerY);
    ctx.rotate(angle);
    ctx.fillStyle = `hsl(${hue},100%,50%)`;
    ctx.fillRect(radius, -2, barLength, 4);
    ctx.restore();
  }
}
draw();

// ====== Play/Pause Logic ======
playPauseBtn.addEventListener('click', () => {
  if (currentSong === "") return; // safety check

  if (isPlaying) {
    audio.pause();
    playPauseBtn.textContent = '▶ Play';
  } else {
    audioCtx.resume();
    audio.play();
    playPauseBtn.textContent = '⏸ Pause';
  }
  isPlaying = !isPlaying;
});

audio.addEventListener('ended', () => {
  playPauseBtn.textContent = '▶ Play';
  isPlaying = false;
});

// ====== Volume Control ======
volumeControl.addEventListener('input', () => {
  audio.volume = volumeControl.value;
});

// ====== Progress Bar ======
function updateProgress() {
  if (audio.duration) {
    const percent = (audio.currentTime / audio.duration) * 100;
    progress.style.width = percent + '%';
  }
  requestAnimationFrame(updateProgress);
}
updateProgress();

progressContainer.addEventListener('click', (e) => {
  if (!audio.duration) return;
  const rect = progressContainer.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const percent = x / rect.width;
  audio.currentTime = percent * audio.duration;
});

// ====== Custom File Upload ======
fileInput.addEventListener('change', e => {
  const file = e.target.files[0];
  if (file) {
    const url = URL.createObjectURL(file);
    audio.src = url;
    const name = file.name.replace(/\.[^/.]+$/, ""); // remove extension
    trackTitle.textContent = `Now Playing: ${name}`;
    isPlaying = false;
    playPauseBtn.textContent = '▶ Play';
    currentSong = url;
    playPauseBtn.disabled = false;
    updateActiveSong();
  }
});

// ====== Song Menu Buttons ======
function updateActiveSong() {
  songButtons.forEach(btn => {
    if (btn.getAttribute('data-file') === currentSong) {
      btn.classList.add('active');
    } else {
      btn.classList.remove('active');
    }
  });
}

songButtons.forEach(button => {
  button.addEventListener('click', () => {
    const file = button.getAttribute('data-file');
    audio.src = file;
    const name = file.replace(/\.[^/.]+$/, "");
    trackTitle.textContent = `Now Playing: ${name}`;
    isPlaying = false;
    playPauseBtn.textContent = '▶ Play';
    currentSong = file;
    playPauseBtn.disabled = false;
    updateActiveSong();
  });
});
</script>
</body>
</html>
